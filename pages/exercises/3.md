# L'update optimiste

Pour faire cette exercice, n'oublie pas de lire la partie du cour sur les mutations
et l'update optimiste.

On va faire fonctionn√© le bouton like durant cette exercice.

Le but est d'affich√© le like avant m√™me de l'avoir fait, pour ne pas faire
attendre inutilement l'utilisateur.

##¬†Part 1 : Like / dislike

On va dans une premi√®re √©tape faire **sans useQuery**. Pour √ßa, tu peux suivre les
instructions du ü¶Å.

Mais en gros, tu vas utiliser remplir la fonction `tweetLike` qui va, en fonction
de `liked` la props qui d√©finit si oui ou non le tweet √† √©t√© like _par l'utilisateur_,
d√©finir la m√©thode ("POST" ou "DELETE") et appel√© l'url pour cr√©er ou supprim√©
la relations entre le tweet et l'utilisateur.

Dans un deuxi√®me temps on va cr√©er la fonction `onClick` qui va appel√©
la fonction `tweetLike` et :

- si c'est un succ√®s (`.then`) : invalid√© la query des tweets
- si c'est un √©chec (`.catch`) : affich√© un message d'erreur
- finalement on va d√©finir le state `isLoading` √† false

## Part 2 : useMutation

Maintenant on va utilis√© useMutation pour profiter de toute la puissance de useQuery
et surtout int√©grer l'optimistic update.

Notre but va √™tre de modifier "artificiellement" le cache de la query `tweets`
en faisant lik√© le tweet par l'utilisateur.

Pour √ßa il y a de propri√©t√© √† changer :

- `liked` qui doit changer de true √† false
- `_count.likes` qui doit changer de +1 ou -1 en fonction de `liked`

Tu vas pouvoir supprimer le state `isLoading` car `useMutation` g√®re d√©j√† ce state.

Puis on va cr√©er notre mutation en suivant ce qu'on a fait durant le cours.

Tu peux suivre ses instructions :

```js
// ü¶Å Ajoute un hooks useMutation qui va
// * utiliser la fonction likeTweet
// * utilise le param√®tre `onMutate` pour mettre √† jour le cache
//   * utilise la m√™me syntaxe que dans mon cours
//   * invalid le cache de la query `tweets`
//   * utilise `queryClient.getQueryData` pour r√©cup√©rer le cache et le stoker dans une variable
//   * utilise `queryClient.setQueryData` pour mettre √† jour le cache en fonction de liked
// * utilise le param√®tre `onError` pour afficher une notification d'erreur et rollback le cache
//   * tu peux utiliser la fonction `notifyFailed`
// * utilise le param√®tre `onSuccess` pour invalider le cache de la query `tweets`
```

C'est pas un exercice facile, mais en t'aidant du cours, d'internet de du discord tu devrais
facilement r√©ussir. Tu verras le grand avantage que √ßa apporte.
