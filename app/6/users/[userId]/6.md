Hello et bienvenue dans le dernier exercice de notre application. Je te pr√©viens, **il est compliqu√©** !
Mais ne t'en fais pas, ce que tu vas apprendre dans cet exercice va te faire gagner beaucoup de temps dans le futur.

On va construire la page d'un utilisateur, qui va afficher les informations de l'utilisateur, les tweets qu'il a faits, le nombre de followers etc...

On va avoir 4 parties :

1. R√©cup√©rer les donn√©es utilisateur et les afficher
2. R√©cup√©rer les tweets et les afficher
3. G√©rer le "Follow button" pour pouvoir suivre et arr√™ter de suivre un utilisateur
4. G√©rer l'infinite scroll pour afficher les tweets de l'utilisateur avec use-query !
5. G√©rer les erreurs et le loading

Je vais te m√¢cher une grosse partie du travail car il y a beaucoup √† faire et j'ai moi-m√™me pass√© plusieurs heures pour r√©aliser cette exercice.

## Part 1 : R√©cup√©rer les donn√©es utilisateur et les afficher

On va r√©cup√©rer les donn√©es de l'utilisateur ainsi que l'id de l'utilisateur connect√©.
On va ensuite d√©finir si oui ou non l'utilisateur connect√© est celui que l'on affiche, puis on va d√©finir si l'utilisateur connect√© suit actuellement l'utilisateur que l'on affiche.

Lienx t'aidera pour cet exercice ü¶Å.

## Part 2 : R√©cup√©rer les tweets et les afficher

Pour √ßa on va utiliser la fonction : `await getUserTweets(params.userId, currentUserId);` pour r√©cup√©rer les tweets de l'utilisateur.

Une fois r√©cup√©r√©s, tu pourras rajouter en dessous de notre user un titre pour d√©limiter les sections et afficher les tweets de l'utilisateur.

## Part 3 : G√©rer le "Follow button" pour pouvoir suivre et arr√™ter de suivre un utilisateur

C'est ici que √ßa devient compliqu√©. Jusqu'ici notre follow bouton ne fait rien. Ton travail c'est de cr√©er un composant dans le dossier exercice qui se nomme `FollowButton` et qui va g√©rer le follow et unfollow d'un utilisateur.

Voici les props qu'il va prendre :

```ts
type FollowButtonProps = PropsWithChildren<{
  userId: string;
  disabled?: boolean;
  isAlreadyFollowing?: boolean;
}>;
```

Tu vas pouvoir follow / unfollow l'utilisateur avec cette fonction :

```ts
client(`/api/users/${userId}/follow`, {
  method: isAlreadyFollowing ? 'DELETE' : 'POST',
});
```

Pour le bouton, il doit √™tre disable si l'utilisateur actuellement affich√© est l'utilisateur connect√©.

Tu peux rajouter des toast pour indiquer si l'utilisateur a bien √©t√© follow ou unfollow, et aussi en cas d'erreur !

‚ö†Ô∏è C'est un client component

## Part 4 : G√©rer l'infinite scroll pour afficher les tweets de l'utilisateur avec use-query !

Ok ici c'est la partie **la plus compliqu√©e**, et de loin. Je vais te donner un nouveau composant `TweetWithLike` qui va g√©rer uniquement le cas d'un tweet li√© √† un utilisateur. Tu peux soit le faire toi-m√™me, soit utiliser celui que j'ai fait dans le dossier `solution4/TweetWithLike.tsx`.

Ce composant va utiliser la nouvelle cl√© useQuery que j'ai d√©finie : `['tweets', 'user', id]` que tu peux r√©cup√©rer avec `tweetsKeys.getByUser(userId)`

Tu vas devoir cr√©er un nouveau composant nomm√© `TweetsTL` qui sera un client component.

Voici le hooks `useInfiniteTweet` pour r√©cup√©rer les tweets de l'utilisateur :

```ts
const getUserTweets = async (userId: string, signal?: AbortSignal, page = 0) =>
  client(`/api/users/${userId}/tweets?page=${page}`, {
    signal,
    zodSchema: TweetsScheme,
  });

export const useInfiniteTweets = (
  userId: string,
  defaultTweets: TlTweetsPage
) =>
  useInfiniteQuery({
    queryKey: tweetKeys.getByUser(userId),
    queryFn: ({ signal, pageParam }) =>
      getUserTweets(userId, signal, pageParam),
    getNextPageParam: (lastPage) => lastPage.nextPage,
    initialData: {
      pages: [defaultTweets],
      pageParams: [0],
    },
  });
```

Comme tu le vois on utilise le m√™me type que pour la tl, mais la cl√© et le fetch sont diff√©rents.

Ton but maintenant c'est de faire en sorte que les default tweets soient fetch dans notre server component, puis affich√©s dans notre client component `TweetsTL` via le hook useInfiniteTweets.

Ce hook va te retourner les fonctions n√©cessaires pour fetch lors du scroll, tu peux r√©-utiliser le composant `TweetsNextButton` pour afficher le bouton de fetch (et surtout avoir la magie du infinite scroll).

Normalement, gr√¢ce √† la puissance de useQuery et de NextJS on devrait pouvoir like les tweets etc...

Et m√™me quand tu follow / unfollow, vu que React Query garde tout en cache, la liste de tweet n'est pas d√©truite.

## Part 5 : G√©rer les erreurs et le loading

Bravo d'√™tre arriv√© jusqu'ici. Il est temps de g√©rer les erreurs et le loading. Si tu passes un mauvais userId qui n'existe pas, notre route va crasher. Ajoute un fichier `error.tsx` pour g√©rer cette erreur.

Tu peux utiliser le composant `Error.tsx` pour afficher l'erreur, et notre fameux Loader pour le loader üßê
